<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Quizy - The Quiz Game</title>
	</head>
	<body>
		<h1 id="question"></h1>
		<form name="quiz">
			<div>
				<input type="radio" name="choice" id="a1" value="0"><span id="choice0"></span>
			</div>
			<div>
				<input type="radio" name="choice" id="a2" value="1"><span id="choice1"></span>
			</div>
			<div>
				<input type="radio" name="choice" id="a3" value="2"><span id="choice2"></span>
			</div>
			<div>
				<input type="radio" name="choice" id="a4" value="3"><span id="choice3"></span>
			</div>
			<br>
			<input type="button" name="prev" value="Previous Question">
			<input type="button" name="next" value="Next Question">
			<br>
			<input type="button" name="fin" value="Finished, See Score">
		</form>
		<script>
			var answers = [];
			var currentQuestion = 0;
			
			//initial load
			var request = new XMLHttpRequest();
			request.open("GET", "quizappdata.json", false);
			request.send(null);
			request = JSON.parse(request.responseText);
			var qArr = request[currentQuestion].answers;
			var qQue = request[currentQuestion].question;
			var ansSpans = document.querySelectorAll("span");
			document.getElementById("question").innerHTML = qQue;
			for (var i = 0; i < ansSpans.length; i ++) {
				ansSpans[i].innerHTML = qArr[i];
			}
			
			//get checked choice
			function getChecked() {
				var choices = document.quiz.choice;
				for (var i = 0; i < choices.length; i++) {
					if (choices[i].checked) {
						return choices[i].value;
					}
				}
				return undefined;
			}
			
			//handle next button click
			function nextHandler() {
				//check if choice selected
				var selectedChoice = getChecked();
				if ( isNaN(selectedChoice) ) {
					return;
				}
				//record answer
				answers[currentQuestion] = selectedChoice;
				//make sure not to go over the amount of questions
				if (currentQuestion == request.length - 1) {
					return;
				}
				//still more question, move to next question
				currentQuestion++;
				qArr = request[currentQuestion].answers;
				qQue = request[currentQuestion].question;
				//set question
				var ansSpans = document.querySelectorAll("span");
				//set choices
				document.getElementById("question").innerHTML = qQue;
				for (var i = 0; i < document.quiz.choice.length; i++) {
					if (document.quiz.choice[i].checked) {
						document.quiz.choice[i].checked = "";
					}
				}
				for (var i = 0; i < ansSpans.length; i++) {
					ansSpans[i].innerHTML = qArr[i];
					if (i == answers[currentQuestion]) {
						document.quiz.choice[i].checked = "checked";
					}
				}
			}
			
			function prevHandler() {
				if (currentQuestion == 0) {
					return;
				} else {
					var selectedChoice = getChecked();
					if (selectedChoice) {
						answers[currentQuestion] = selectedChoice;
					}
					currentQuestion -= 1;
				}
				qArr = request[currentQuestion].answers;
				qQue = request[currentQuestion].question;
				document.getElementById("question").innerHTML = qQue;
				var ansSpans = document.querySelectorAll("span");
				for (var i = 0; i < ansSpans.length; i++) {
					ansSpans[i].innerHTML = qArr[i];
					if (i == answers[currentQuestion]) {
						document.quiz.choice[i].checked = "checked";
					}
				}
			}
			
			document.quiz.next.addEventListener("click", nextHandler);
			document.quiz.prev.addEventListener("click", prevHandler);
		</script>
	</body>
</html>